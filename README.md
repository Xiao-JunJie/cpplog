### 当前的性能
在我的i5-7500 16G内存 4核 2.3GHz 的个人pc机上单线程写入一百万条日志平均在0.53s的时间  
![img.png](img.png)
### 优化的记录
| 序号 | 优化措施 | 描述 | 写入条数 | 写入大小 | 写入时间 |  
| ---- | -------- | ---- | -------- |-------- | -------- |  
| 1    | 初始方法 | 每写一条到内存都会立即刷进磁盘 | 一百万    | 103M    | 180s     |  
| 2    | 加入缓冲区 | 使用`std::deque`作为缓冲区，单独的写入磁盘线程将日志定期集中写入磁盘 | 一百万    | 103M    | 5s       |  
| 3    | 替换缓冲区 | `std::deque`的push和pop比较耗时，替换为自实现的缓冲区 | 一百万    | 103M    | 2.3s     |  
| 4    | 信号量通知 | 刷入磁盘线程定时睡眠检查chunk的状态会出现“空醒”情况，修改为一个chunk写满后用信号量通知写入磁盘线程 | 一百万    | 103M    | 2.2s     |  
| 5    | 修改拼接方式 | 将写日志时使用的字符流拼接方式修改为字符串拼接（+） | 一百万    | 103M    | 1.2s     |  
| 6    | string改为char* | string + 拼接会产生拷贝且性能不够高效，故删除掉string | 一百万    | 103M    | 0.82s   |
| 7    | 减少时间调用次数 | 本日志系统的时间戳的最小单位为秒，不必每条日志都调用一次本地时间转换 | 一百万    | 103M    | 0.59s   |
| 8    | 使用自旋锁 | 使用自实现的自旋锁替换互斥锁 | 一百万    | 103M    | 0.53s   |
| 9    | 下一步优化 | 继续减少非必要的拷贝和系统调用的情况发生 | 一百万    | 103M    | 待验证   |

### 使用方法
如果你的g++编译器支持C++ 11及以上版本，copy Log下的头文件和源代码后可以轻松加入到项目中并运行起来。但如果为内存敏感项目，请注意调整对应的chunk大小及数量，默认为1M * 8个组成的RingBuff。  
具体的使用方法参见main.cpp
